<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>PROMIS v2.0 – Satisfacción con la vida sexual</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 1.5rem;
      line-height: 1.5;
      background: #f7f7f7;
    }
    h1, h2 { text-align: center; }
    .card {
      background: #ffffff;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .question {
      margin-bottom: 1.2rem;
      padding-bottom: 0.8rem;
      border-bottom: 1px solid #eee;
    }
    .question:last-of-type { border-bottom: none; }
    .options { display: flex; flex-wrap: wrap; gap: 0.4rem 1.5rem; }
    label { cursor: pointer; }
    .small-muted { font-size: 0.85rem; color: #666; }
    textarea {
      width: 100%;
      min-height: 150px;
      font-family: monospace;
      font-size: 0.9rem;
    }
    button {
      padding: 0.7rem 1.3rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
    }
    #submitBtn { background: #2563eb; color: white; }
    #downloadCsvBtn, #copyBtn { background: #ddd; margin-top: 0.5rem; margin-right: 0.5rem; }
    #resultsCard { display: none; }
  </style>
</head>
<body>

<h1>PROMIS v2.0</h1>
<h2>Satisfacción con la vida sexual</h2>

<div class="card">
  <p class="small-muted">
    Responda a cada pregunta marcando una opción. Este cuestionario es anónimo salvo indicación contraria.
  </p>
</div>

<form id="promis-form" class="card">

  <!-- Sexo -->
  <div class="question">
    <p>Sexo de referencia para normas PROMIS:</p>
    <div class="options">
      <label><input type="radio" name="sexo_ref" value="F" required> Mujer</label>
      <label><input type="radio" name="sexo_ref" value="M"> Hombre</label>
    </div>
  </div>

  <!-- Ítems -->
  <div class="question">
    <p>SFSAT101 – ¿Hasta qué punto ha estado satisfecho/a con su vida sexual?</p>
    <div class="options">
      <label><input type="radio" name="SFSAT101" value="1" required>1</label>
      <label><input type="radio" name="SFSAT101" value="2">2</label>
      <label><input type="radio" name="SFSAT101" value="3">3</label>
      <label><input type="radio" name="SFSAT101" value="4">4</label>
      <label><input type="radio" name="SFSAT101" value="5">5</label>
    </div>
  </div>

  <div class="question">
    <p>SFSAT102r – ¿Cuánto placer le ha dado su vida sexual?</p>
    <div class="options">
      <label><input type="radio" name="SFSAT102r" value="1" required>1</label>
      <label><input type="radio" name="SFSAT102r" value="2">2</label>
      <label><input type="radio" name="SFSAT102r" value="3">3</label>
      <label><input type="radio" name="SFSAT102r" value="4">4</label>
      <label><input type="radio" name="SFSAT102r" value="5">5</label>
    </div>
  </div>

  <div class="question">
    <p>SFSAT103 – ¿Con qué frecuencia ha pensado que su vida sexual es maravillosa?</p>
    <div class="options">
      <label><input type="radio" name="SFSAT103" value="1" required>1</label>
      <label><input type="radio" name="SFSAT103" value="2">2</label>
      <label><input type="radio" name="SFSAT103" value="3">3</label>
      <label><input type="radio" name="SFSAT103" value="4">4</label>
      <label><input type="radio" name="SFSAT103" value="5">5</label>
    </div>
  </div>

  <div class="question">
    <p>SFSAT201 – ¿Hasta qué punto ha estado satisfecho/a con sus relaciones sexuales?</p>
    <div class="options">
      <label><input type="radio" name="SFSAT201" value="0" required>0 – No he tenido relaciones</label>
      <label><input type="radio" name="SFSAT201" value="1">1</label>
      <label><input type="radio" name="SFSAT201" value="2">2</label>
      <label><input type="radio" name="SFSAT201" value="3">3</label>
      <label><input type="radio" name="SFSAT201" value="4">4</label>
      <label><input type="radio" name="SFSAT201" value="5">5</label>
    </div>
  </div>

  <div class="question">
    <p>SFSAT105r – ¿Cuánto ha disfrutado la actividad sexual? (Descriptivo)</p>
    <div class="options">
      <label><input type="radio" name="SFSAT105r" value="1" required>1</label>
      <label><input type="radio" name="SFSAT105r" value="2">2</label>
      <label><input type="radio" name="SFSAT105r" value="3">3</label>
      <label><input type="radio" name="SFSAT105r" value="4">4</label>
      <label><input type="radio" name="SFSAT105r" value="5">5</label>
    </div>
  </div>

  <button id="submitBtn" type="submit">Enviar</button>
</form>

<div id="resultsCard" class="card">
  <h3>Resultados</h3>
  <textarea id="resultsText" readonly></textarea>
  <button id="copyBtn">Copiar</button>
  <button id="downloadCsvBtn">Descargar CSV</button>
</div>

<script>
/* -----------------------------------
   TABLA RAW → T-SCORE (OFICIAL PROMIS)
--------------------------------------*/

const tScoreTable = {
  4: 30.7,
  5: 35.6,
  6: 37.6,
  7: 39.1,
  8: 40.5,
  9: 41.8,
  10: 43.3,
  11: 44.7,
  12: 46.2,
  13: 47.8,
  14: 49.4,
  15: 51.1,
  16: 52.8,
  17: 54.6,
  18: 56.7,
  19: 59.5,
  20: 65.1
};

/* INTERPRETACIÓN */
function interpretTScore(t) {
  if (t < 40) return "Baja satisfacción sexual (−1 DE por debajo del promedio)";
  if (t <= 60) return "Satisfacción dentro del rango promedio (±1 DE)";
  return "Alta satisfacción sexual (+1 DE por encima del promedio)";
}

/* CSV */
const allResults = [];

document.getElementById("promis-form").addEventListener("submit", function(e){
  e.preventDefault();

  const form = new FormData(e.target);
  const sexo = form.get("sexo_ref");

  const s1 = Number(form.get("SFSAT101"));
  const s2 = Number(form.get("SFSAT102r"));
  const s3 = Number(form.get("SFSAT103"));
  const s4 = Number(form.get("SFSAT201"));
  const s5 = Number(form.get("SFSAT105r"));

  let text = [];
  const today = new Date().toISOString().slice(0,10);

  text.push("PROMIS v2.0 – Satisfacción con la vida sexual");
  text.push("Fecha: " + today);
  text.push("Sexo de referencia para normas: " + (sexo==="M"?"hombre":"mujer"));
  text.push("");
  text.push("Respuestas:");
  text.push("SFSAT101: " + s1);
  text.push("SFSAT102r: " + s2);
  text.push("SFSAT103: " + s3);
  text.push("SFSAT201: " + s4);
  text.push("SFSAT105r (descriptivo): " + s5);
  text.push("");

  if (s4===0){
    text.push("No se calcula T-score porque la persona no ha tenido relaciones sexuales en los últimos 30 días (criterio PROMIS).");
  } else {
    const raw = s1 + s2 + s3 + s4;
    const t = tScoreTable[raw];
    const interpre = interpretTScore(t);

    text.push("Puntuación bruta (raw score): " + raw);
    text.push("T-score PROMIS: " + t);
    text.push("Interpretación: " + interpre);

    allResults.push({
      fecha: today, sexo, s1, s2, s3, s4, s5, raw, t, interpre
    });
  }

  document.getElementById("resultsText").value = text.join("\n");
  document.getElementById("resultsCard").style.display = "block";
});

/* Copiar */
document.getElementById("copyBtn").onclick = () =>
  navigator.clipboard.writeText(document.getElementById("resultsText").value);

/* Descargar CSV */
document.getElementById("downloadCsvBtn").onclick = () => {
  if (allResults.length===0) return alert("No hay datos aún.");
  let csv = "fecha,sexo,SFSAT101,SFSAT102r,SFSAT103,SFSAT201,SFSAT105r,raw,t,interpretacion\n";
  allResults.forEach(r=>{
    csv += `${r.fecha},${r.sexo},${r.s1},${r.s2},${r.s3},${r.s4},${r.s5},${r.raw},${r.t},"${r.interpre}"\n`;
  });
  const blob = new Blob([csv],{type:"text/csv"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "promis_sexlife_scores.csv";
  a.click();
};

</script>
</body>
</html>
